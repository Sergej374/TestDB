using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Data.SqlClient;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace MyTestsDB
{
    public partial class OpenTestForm : Form
    {
        SqlConnection Connection { get; }
        TeacherPanelForm parent { get; }

        public OpenTestForm(TeacherPanelForm parent)
        {
            InitializeComponent();
            this.parent = parent;
            Connection = testsTableAdapter.Connection;
            Connection.Open();

            DataTable data = Connection.GetSchema("Tables");
            foreach(DataRow row in data.Rows)
            {
                string tableName = row["TABLE_NAME"].ToString();
                if (Regex.IsMatch(tableName, @"^\w*_" + parent.TeacherCreatorID))
                {
                    Button testButton = new Button();
                    testButton.Text = tableName.Substring(0, tableName.IndexOf('_'));
                    testButton.Name = tableName;
                    testButton.Left = Left + 5;
                    testButton.Top = Top + Controls.Count * (testButton.Height + 3);
                    testButton.Click += LoadTest;
                    Controls.Add(testButton);
                }
            }

            Connection.Close();
        }

        private void LoadTest(object sender, EventArgs e)
        {
            parent.DownloadTest((sender as Button).Name);
            Close();
        }
    }
}
